<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<script src="/webjars/jquery/jquery.min.js"></script>
<head>
    <meta charset="UTF-8">
    <title th:text="@{'옥션월드'}"></title>
</head>
<body onload="check()">
<div class="container">
    <div th:replace="fragments/bodyHeader :: bodyHeader"/>
    <form th:object="${form}" method="post">
        <td>
            <h2><a id="modifyButton" href="#" th:href="@{/post/{id}/edit (id=${form.id})}" class="btn btn-primary" role="button">수정</a></h2>
        </td>
        <td>
            <a id="deleteButton" href="#" th:href="@{/post/{id}/delete (id=${form.id})}" class="btn btn-delete" role="button">삭제</a>
        </td><br>
        <input type="hidden" th:field="*{id}" />
        <input type="hidden" th:field="*{postUserId}">
        <input type="hidden" th:field="*{currentBidId}">

        카테고리 : <p th:text="*{category}"></p>
        <input type="hidden" th:field="*{category}">

        상품명 : <h5 id="title" th:text="*{productName}"></h5>
        <input type="hidden" th:field="*{productName}">

        제목 : <p th:text="*{title}"></p>
        <input type="hidden" th:field="*{title}">

        내용 : <p th:text="*{contents}"></p>
        <input type="hidden" th:field="*{contents}">

        현재 상태 : <p id="status" th:text="*{status}"></p>
        <input type="hidden" th:field="*{status}">

        <div>
            시작가 : <p id="startBid" th:text="*{startBid}"></p>
            <input type="hidden" th:field="*{startBid}">
        </div>

        다음 입찰가 : <p id="currentBid" th:text="*{nextBid}"></p>
        <input type="hidden" th:field="*{nextBid}">

        낙찰가 : <p id="winningBid" th:text="*{winningBid}"></p>
        <input type="hidden" th:field="*{winningBid}">

        입찰단위 : <p id="unit" th:text="*{unitBid}"></p>
        <input type="hidden" th:field="*{unitBid}">

        경매기간 : <p id="period" th:text="*{auctionPeriod}">시간</p>
        <input type="hidden" th:field="*{auctionPeriod}">

        남은 시간 : <p id="remainingTime">24</p>

        올린시간 : <p id="regisTime" th:text="*{regisTime}"></p>
        <input type="hidden" th:field="*{regisTime}">
        <p>
            <button type="submit" th:if="${form.status == '입찰 중'}" onclick="bid()">입찰하기</button>
            <button type="submit" th:if="${form.status != '입찰 중'}" onclick="bid()" disabled="disabled">입찰하기</button>
        </p>
    </form>
    <form action="/auction/buy" method="post">
        <input type="hidden" th:field="${form.id}">
        <button type="submit" th:if="${form.status == '입찰 중'}" onclick="buy()">즉시 구매</button>
        <button type="submit" th:if="${form.status != '입찰 중'}" onclick="bid()" disabled="disabled">즉시 구매</button>
    </form>
</div>
</body>
<script th:inline="javascript">
    const period = [[${form.auctionPeriod}]];
    const status = [[${form.status}]];

    //게시글 작성 사용자가 아니면 수정,삭제 버튼 없애기
    /*<![CDATA[*/
    var postUserName =  [[${postUserName}]];
    var loginUsername = [[${loginName}]];
    /*]]>*/
    console.log(postUserName);
    console.log(loginUsername);

    if(postUserName!==loginUsername) {
        console.log("수정 삭제 금지");
        document.getElementById('modifyButton').style.display = 'none';
        document.getElementById('deleteButton').style.display = 'none';
    }

    function check(){
        if(status === '입찰 종료'){
            alert("입찰 종료된 상품입니다.");
        }
        else if(status === '낙찰됨'){
            alert("낙찰된 상품입니다.");
        }
        else if(status === '구매 완료'){
            alert("구매 완료된 상품입니다.");
        }
        else{
            //calcDay();
            //setInterval(calcDay, 1000);
        }
    }

    function bid(){
        var aucId = [[${session.id}]];
        var regisId = [[${form.postUserId}]];

        if(aucId != regisId){
            if(confirm("입찰하시겠습니까?")){
                alert("입찰에 성공했습니다");
            }
            else{
                event.preventDefault();
            }
        }
        else{
            alert("자신의 물품은 입찰할 수 없습니다.");
            event.preventDefault();
        }
    }
    function buy(){
        var buyId = [[${session.id}]];
        var regisId = [[${form.postUserId}]];

        if(buyId != regisId){
            if(confirm("즉시 구매하시겠습니까?")){
                alert("성공적으로 구매되었습니다.");
            }
            else{
                event.preventDefault();
            }
        }
        else{
            alert("자신의 물품은 구매할 수 없습니다.");
            event.preventDefault();
        }
    }
</script>
</html>